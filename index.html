<!DOCTYPE html>
<html lang="en" style="background: #000;">

<head>
    <meta charset="UTF-8" />
    <title>AuctionX</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="manifest" href="manifest.json" />
    <!-- Preload critical images for instant splash -->
    <link rel="preload" as="image" href="BackGround.png" />
    <link rel="preload" as="image" href="PoweredBy.png" />
    <!-- Optionally preload logo placeholder -->
    <link rel="preload" as="image" href="" id="logoPreload" />
    <style>
        html,
        body {
            margin: 0;
            padding: 0;
            background: #000;
            width: 100%;
            height: 100%;
            overflow: hidden;
            touch-action: none;
        }

        #gameContainer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100svh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #ffffff;
            overflow: hidden;
        }

        #gameFrame {
            aspect-ratio: 9 / 16;
            height: 100%;
            max-width: 100vw;
            border: none;
            display: block;
            background: #000;
            z-index: 1;
        }

        #splashScreen {
            position: absolute;
            aspect-ratio: 9 / 16;
            left: 50%;
            transform: translateX(-50%);
            z-index: 2;

            max-width: 100vw;
            /* scale relative to device width */
            height: 100%;

            /* ensure it doesn't exceed screen height */
            /* width: auto;
            height: auto; */
            /* display: none; */
            /* Hidden by default, shown after dynamic sizing */
        }

        #logo,
        #PoweredBy {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            z-index: 3;
            max-width: 990px;
            /* scale relative to device width */
            max-height: 10rem;
            /* ensure it doesn't exceed screen height */
            width: auto;
            height: auto;
        }

        #logo {
            top: 40%;
            display: none;
        }

        #PoweredBy {
            top: 86%;
        }

        @supports not (aspect-ratio: 1) {

            #gameFrame {
                width: 360px;
                height: 640px;
            }
        }
    </style>
</head>

<body>
    <div id="rotate-warning" style="display:none;">Please rotate your device to portrait mode</div>

    <div id="gameContainer">
        <img id="splashScreen" alt="Auction splashScreen" src="BackGround.png" />
        <img id="logo" alt="Auction Logo" />
        <img id="PoweredBy" alt="Auction PoweredBy" src="PoweredBy.png" />
        <iframe id="gameFrame" src="" allowfullscreen></iframe>
        <!-- Loading spinner overlay -->

    </div>

    <script>
        const StaticProperties = {
            hostname: '',
            apiBaseURL: 'https://api.auctionx.dev/',
        };

        const localHosts = ['localhost:3000', '127.0.0.1:3000'];

        (function detectHostname() {
            const parsedUrl = new URL(window.location.href);
            StaticProperties.hostname = parsedUrl.host;
            if (localHosts.includes(StaticProperties.hostname)) {
                StaticProperties.hostname = 'tushar.auctionx.dev';
            } else {
                StaticProperties.hostname = 'tushar.auctionx.dev';
            }
        })();

        // Load logo dynamically
        (async function fetchAndSetLogo() {
            try {
                const url = `${StaticProperties.apiBaseURL}v1/auction-house/auction-house-id?subdomain=${StaticProperties.hostname}`;

                const response = await fetch(url);
                const result = await response.json();

                if (
                    result.success &&
                    result.data?.currentAuctionHouse?.medias?.local_path
                ) {
                    const imagePath = result.data.currentAuctionHouse.medias.local_path;
                    const imageUrl = StaticProperties.apiBaseURL + imagePath;

                    const logo = document.getElementById('logo');
                    const PoweredBy = document.getElementById('PoweredBy');
                    // Preload logo image for faster display
                    const logoPreload = new window.Image();
                    logoPreload.src = imageUrl;
                    logoPreload.onload = () => {
                        logo.src = imageUrl;
                        logo.style.display = 'block';
                        // Hide loading spinner when logo is ready
                        const spinner = document.getElementById('loadingSpinner');
                        if (spinner) spinner.style.display = 'none';
                    };
                    // Show logo placeholder instantly (optional)
                    logo.style.display = 'none';
                }
            } catch (error) {
                console.error("Error loading logo:", error);
                // Hide spinner even if logo fails
                const spinner = document.getElementById('loadingSpinner');
                if (spinner) spinner.style.display = 'none';
            }
        })();

        // Orientation and responsive handling
        function checkOrientation() {
            const isPortrait = window.matchMedia("(orientation: portrait)").matches;
            document.getElementById('rotate-warning').style.display = isPortrait ? 'none' : 'block';
        }

        window.addEventListener("orientationchange", checkOrientation);
        window.addEventListener("resize", checkOrientation);
        checkOrientation();

        const gameFrame = document.getElementById('gameFrame');

        const logo = document.getElementById('logo');
        const PoweredBy = document.getElementById('PoweredBy');

        function isTablet() {
            const ua = navigator.userAgent.toLowerCase();
            return (
                ua.includes("ipad") ||
                (ua.includes("android") && !ua.includes("mobile")) ||
                (navigator.platform === "MacIntel" && navigator.maxTouchPoints > 1)
            );
        }

        function isMobile() {
            return /Mobi|Android|iPhone|iPod/i.test(navigator.userAgent);
        }

        function setDynamicAspectRatio() {
            const screenWidth = window.innerWidth;
            const screenHeight = window.innerHeight;
            if (screenHeight === 0) return;

            const aspectRatio = (screenWidth / screenHeight).toFixed(4);
            console.log('Device aspect ratio:', aspectRatio);
            gameContainer.style.background = "#ffffff";

            if (isTablet()) {
                console.log("Tablet detected â€” using 9/20 aspect ratio");
                gameContainer.style.background = "#130c20";
                gameFrame.style.aspectRatio = "9 / 20";

                logo.style.height = "3rem";
                logo.style.width = "165px";
                PoweredBy.style.height = "3rem";
                PoweredBy.style.width = "165px";
                return;
            }
            else if (!isMobile()) {
                // logo.style.height = "10rem";
                // logo.style.width = "303px";
                // PoweredBy.style.height = "10rem";
                // PoweredBy.style.width = "330px";
            }
            if (isMobile()) {
                gameFrame.style.aspectRatio = `${screenWidth} / ${screenHeight}`;
                gameContainer.style.background = "#130c20";
                if (aspectRatio < 0.45) {
                    gameFrame.style.aspectRatio = "9 / 20";
                } else if (aspectRatio > 0.7) {
                    gameFrame.style.aspectRatio = "16 / 9";
                }

                logo.style.height = "3rem";
                logo.style.width = "165px";
                PoweredBy.style.height = "3rem";
                PoweredBy.style.width = "165px";
            }
        }

        // Load game and hide splash after it's ready
        window.addEventListener('load', () => {
            setDynamicAspectRatio();
            gameFrame.src = 'web-mobile/index.html';
            // Show splash and spinner instantly
            document.getElementById('splashScreen').style.display = 'block';
            const spinner = document.getElementById('loadingSpinner');
            if (spinner) spinner.style.display = 'block';
        });

        window.addEventListener('resize', setDynamicAspectRatio);
        window.addEventListener('orientationchange', setDynamicAspectRatio);

        // PWA: Register service worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(() => console.log('Service Worker Registered'))
                    .catch(err => console.error('Service Worker Error:', err));
            });
        }
    </script>
</body>

</html>