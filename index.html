<!DOCTYPE html>
<html lang="en" style="background: #000000">

<head>
  <meta charset="UTF-8" />
  <title>AuctionX</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <link rel="manifest" href="manifest.json" />
  <style>
    /* Responsive: logo/powered by for phones */
    @media (max-width: 500px) {
      #logo {
        width: 60vw !important;
        max-width: 90vw !important;
        left: 50%;
        transform: translateX(-50%);
        height: auto;
        max-height: 15vh;
      }

    }

    html,
    body {
      margin: 0;
      padding: 0;
      background: #000000;
      width: 100%;
      height: 100%;
      overflow: hidden;
      touch-action: none;
    }

    #gameContainer {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100svh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: #ffffff;
      overflow: hidden;
    }

    /* Default: desktop/laptop (changed to 9/16) */
    #gameFrame {
      aspect-ratio: 9 / 16;
      height: 100%;
      max-width: 100vw;
      border: none;
      display: block;
      background: #000000;
      z-index: 1;
    }

    /* Mobile override */
    @media (max-width: 768px) {
      #gameFrame {
        aspect-ratio: 9 / 16 !important;
        height: 100%;
        max-width: 100vw;
      }

      #gameContainer {
        background: #130c20 !important;
      }
    }

    /* Splash Screen Background (animated) */
    #splashScreen {
      position: absolute;
      aspect-ratio: 9 / 16;
      left: 50%;
      transform: translateX(-50%);
      z-index: 2;
      height: 100svh;
      max-width: 100vw;
      max-height: 100svh;
      display: block;
      overflow: hidden;
    }

    #logo {
      position: absolute;
      left: 50%;
      top: 40%;
      display: none;
      transform: translateX(-50%);
      z-index: 4;
      width: 20vw;
      max-width: 90vw;
      height: auto;
      max-height: 10vh;
      object-fit: contain;
    }

    /* Animated Powered by text */
    #PoweredByText {
      position: absolute;
      left: 50%;
      top: 85%;
      transform: translateX(-50%, -30px);
      z-index: 4;
      display: flex;
      font-size: clamp(16px, 4vw, 20px);
      /* font-size: 20px; */
      font-weight: bold;
      color: white;
      animation: fadeSlide 0.33s forwards;
    }

    @keyframes fadeSlide {
      to {
        opacity: 1;
        transform: translate(-50%, 0);
      }
    }



    /* Animated Logo letters */
    #LogoText {
      position: absolute;
      top: 90%;
      left: 50%;
      transform: translateX(-50%);
      font-size: clamp(24px, 6vw, 30px);
      font-weight: bold;
      color: white;
      opacity: 0;
      transform: translate(-50%, -30px);
      animation: fadeSlide 0.33s forwards;
      animation: fadeInLogo 0.5s forwards;
      z-index: 4;
    }

    @keyframes fadeInLogo {
      to {
        opacity: 1;
      }
    }

    .letter {
      display: inline-block;
      transform: scale(3);
      opacity: 0;
      color: white;
      animation: scaleDown 0.2s forwards;
    }

    .x {
      font-size: clamp(40px, 10vw, 50px);
      font-weight: bold;
      background: linear-gradient(45deg, #ff0040, #ff4080, #8b00ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .letter:nth-child(1) {
      animation-delay: 0.033s;
    }

    .letter:nth-child(2) {
      animation-delay: 0.1s;
    }

    .letter:nth-child(3) {
      animation-delay: 0.167s;
    }

    .letter:nth-child(4) {
      animation-delay: 0.233s;
    }

    .letter:nth-child(5) {
      animation-delay: 0.3s;
    }

    .letter:nth-child(6) {
      animation-delay: 0.367s;
    }

    .letter:nth-child(7) {
      animation-delay: 0.433s;
    }

    .letter:nth-child(8) {
      animation-delay: 0.5s;
    }

    .letter:nth-child(9) {
      animation-delay: 0.567s;
    }

    @keyframes scaleDown {
      0% {
        transform: scale(3);
        opacity: 0;
      }

      100% {
        transform: scale(1);
        opacity: 1;
      }
    }


    /* Progress bar */
    #progressBarContainer {
      position: absolute;
      left: 50%;
      top: 75%;
      transform: translate(-50%, 0);
      width: 20vw;
      max-width: 90vw;
      height: 4px;
      background: #e0e0e0;
      border-radius: 3px;
      z-index: 5;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      overflow: hidden;
      display: none;
    }

    #progressBar {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #7b2ff2 0%, #f357a8 100%);
      border-radius: 3px;
      transition: width 0.9s cubic-bezier(.4, 0, .2, 1);
      box-shadow: 0 1px 4px rgba(123, 47, 242, 0.15);
    }

    /* Loader GIF */
    #loadingGif {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 10;
      display: none;
      /* hidden by default */
      width: 30vw;
      /* adjust size */
      height: auto;
    }

    /* Animated Gradient Background */
    .gradient-container {
      position: relative;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at 50% 50%, #1a1a3e 0%, #1b3957 50%);
    }

    .gradient-blob {
      position: absolute;
      border-radius: 50%;
      filter: blur(30px);
      opacity: 0.7;
    }

    /* Blobs 1â€“11 with updated colors */
    .blob-1 {
      width: 400px;
      height: 400px;
      background: radial-gradient(circle, #2563eb 0%, #1e40af 30%, transparent 100%);
      top: -200px;
      left: -200px;
      animation: float-1 2.3s ease-in-out infinite alternate;
    }

    .blob-2 {
      width: 350px;
      height: 350px;
      background: radial-gradient(circle, #0891b2 0%, #0e7490 40%, transparent 100%);
      top: 50%;
      right: -175px;
      animation: float-2 2.6s ease-in-out infinite alternate-reverse;
    }

    .blob-3 {
      width: 500px;
      height: 500px;
      background: radial-gradient(circle, #7c3aed 0%, #6d28d9 25%, transparent 100%);
      bottom: -250px;
      left: 30%;
      animation: float-3 2s ease-in-out infinite alternate;
    }

    .blob-4 {
      width: 300px;
      height: 300px;
      background: radial-gradient(circle, #5b21b6 0%, #0369a1 40%, transparent 100%);
      top: 20%;
      left: 60%;
      animation: float-4 2.3s ease-in-out infinite alternate-reverse;
    }

    .blob-5 {
      width: 450px;
      height: 450px;
      background: radial-gradient(circle, #1e40af 0%, #075985 30%, transparent 100%);
      bottom: 10%;
      right: 20%;
      animation: float-5 3s ease-in-out infinite alternate;
    }

    .blob-6 {
      width: 250px;
      height: 250px;
      background: radial-gradient(circle, #06b6d4 0%, #0e7490 40%, transparent 100%);
      top: 70%;
      left: 10%;
      animation: float-6 1.6s ease-in-out infinite alternate-reverse;
    }

    .blob-7 {
      width: 280px;
      height: 280px;
      background: radial-gradient(circle, #7c3aed 0%, #6d28d9 40%, transparent 100%);
      top: 15%;
      left: 15%;
      animation: float-7 2.6s ease-in-out infinite alternate;
    }

    .blob-8 {
      width: 320px;
      height: 320px;
      background: radial-gradient(circle, #0891b2 0%, #0e7490 40%, transparent 100%);
      bottom: 20%;
      left: 25%;
      animation: float-8 2s ease-in-out infinite alternate-reverse;
    }

    .blob-9 {
      width: 300px;
      height: 300px;
      background: radial-gradient(circle, #5b21b6 0%, #0369a1 40%, transparent 100%);
      top: 30%;
      right: 25%;
      animation: float-9 2.3s ease-in-out infinite alternate;
    }

    .blob-10 {
      width: 250px;
      height: 250px;
      background: radial-gradient(circle, #ce2bff 0%, #7c3aed 40%, transparent 100%);
      bottom: 5%;
      left: 50%;
      animation: float-10 3s ease-in-out infinite alternate-reverse;
    }

    .blob-11 {
      width: 230px;
      height: 230px;
      background: radial-gradient(circle, #06b6d4 0%, #0e7490 40%, transparent 100%);
      top: 5%;
      right: 10%;
      animation: float-11 3.3s ease-in-out infinite alternate;
    }

    /* Animations */
    @keyframes float-1 {
      0% {
        transform: translate(0, 0);
      }

      25% {
        transform: translate(100px, -50px);
      }

      50% {
        transform: translate(200px, 100px);
      }

      75% {
        transform: translate(50px, 150px);
      }

      100% {
        transform: translate(150px, 50px);
      }
    }

    @keyframes float-2 {
      0% {
        transform: translate(0, 0);
      }

      30% {
        transform: translate(-120px, 80px);
      }

      60% {
        transform: translate(-80px, -100px);
      }

      100% {
        transform: translate(-150px, 60px);
      }
    }

    @keyframes float-3 {
      0% {
        transform: translate(0, 0);
      }

      20% {
        transform: translate(-80px, -120px);
      }

      40% {
        transform: translate(120px, -80px);
      }

      60% {
        transform: translate(-100px, -160px);
      }

      80% {
        transform: translate(60px, -100px);
      }

      100% {
        transform: translate(-40px, -140px);
      }
    }

    @keyframes float-4 {
      0% {
        transform: translate(0, 0);
      }

      25% {
        transform: translate(-100px, 120px);
      }

      50% {
        transform: translate(-180px, -60px);
      }

      75% {
        transform: translate(-60px, 180px);
      }

      100% {
        transform: translate(-140px, 40px);
      }
    }

    @keyframes float-5 {
      0% {
        transform: translate(0, 0);
      }

      35% {
        transform: translate(80px, -140px);
      }

      70% {
        transform: translate(-120px, -200px);
      }

      100% {
        transform: translate(40px, -170px);
      }
    }

    @keyframes float-6 {
      0% {
        transform: translate(0, 0);
      }

      40% {
        transform: translate(140px, -80px);
      }

      80% {
        transform: translate(200px, -160px);
      }

      100% {
        transform: translate(170px, -120px);
      }
    }

    @keyframes float-7 {
      0% {
        transform: translate(0, 0);
      }

      50% {
        transform: translate(60px, 80px);
      }

      100% {
        transform: translate(-40px, 50px);
      }
    }

    @keyframes float-8 {
      0% {
        transform: translate(0, 0);
      }

      50% {
        transform: translate(-50px, -70px);
      }

      100% {
        transform: translate(30px, 60px);
      }
    }

    @keyframes float-9 {
      0% {
        transform: translate(0, 0);
      }

      50% {
        transform: translate(100px, -50px);
      }

      100% {
        transform: translate(-60px, -80px);
      }
    }

    @keyframes float-10 {
      0% {
        transform: translate(0, 0);
      }

      50% {
        transform: translate(-80px, 100px);
      }

      100% {
        transform: translate(50px, -70px);
      }
    }

    @keyframes float-11 {
      0% {
        transform: translate(0, 0);
      }

      50% {
        transform: translate(70px, -90px);
      }

      100% {
        transform: translate(-50px, 60px);
      }
    }


    /* Glow + noise overlay */
    .glow-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background:
        radial-gradient(circle at 20% 30%, rgba(37, 99, 235, 0.15) 0%, transparent 50%),
        radial-gradient(circle at 80% 70%, rgba(8, 145, 178, 0.15) 0%, transparent 50%),
        radial-gradient(circle at 60% 40%, rgba(124, 58, 237, 0.1) 0%, transparent 50%);
      animation: glow-pulse 1.6s ease-in-out infinite alternate;
    }

    @keyframes glow-pulse {
      0% {
        opacity: .8;
        transform: scale(1);
      }

      50% {
        opacity: 1;
        transform: scale(1.02);
      }

      100% {
        opacity: .8;
        transform: scale(1);
      }
    }

    .noise-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      opacity: 0.03;
      background-image:
        radial-gradient(circle at 25% 25%, white 1px, transparent 1px),
        radial-gradient(circle at 75% 75%, white 1px, transparent 1px);
      background-size: 50px 50px, 75px 75px;
      animation: noise-drift 3.3s linear infinite;
    }

    @keyframes glow-pulse {
      0% {
        opacity: .8;
        transform: scale(1);
      }

      50% {
        opacity: 1;
        transform: scale(1.02);
      }

      100% {
        opacity: .8;
        transform: scale(1);
      }
    }

    .noise-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      opacity: 0.03;
      background-image:
        radial-gradient(circle at 25% 25%, white 1px, transparent 1px),
        radial-gradient(circle at 75% 75%, white 1px, transparent 1px);
      background-size: 50px 50px, 75px 75px;
      animation: noise-drift 3.3s linear infinite;
    }

    @keyframes noise-drift {
      0% {
        transform: translate(0, 0);
      }

      100% {
        transform: translate(-50px, -75px);
      }

    }
  </style>
</head>

<body>
  <div id="rotate-warning" style="display: none">
    Please rotate your device to portrait mode
  </div>

  <div id="gameContainer">
    <!-- Animated splash screen background -->
    <div id="splashScreen">
      <div class="gradient-container">
        <div class="gradient-blob blob-1"></div>
        <div class="gradient-blob blob-2"></div>
        <div class="gradient-blob blob-3"></div>
        <div class="gradient-blob blob-4"></div>
        <div class="gradient-blob blob-5"></div>
        <div class="gradient-blob blob-6"></div>
        <div class="gradient-blob blob-7"></div>
        <div class="gradient-blob blob-8"></div>
        <div class="gradient-blob blob-9"></div>
        <div class="gradient-blob blob-10"></div>
        <div class="gradient-blob blob-11"></div>
        <div class="glow-overlay"></div>
        <div class="noise-overlay"></div>
      </div>
    </div>

    <img id="logo" alt="Auction Logo" />
    <!-- <video id="video" src="myvideo.mp4" autoplay muted loop></video> -->

    <!-- Animated Powered by text -->
    <div id="PoweredByText">Powered by</div>
    <div id="LogoText">
      <span class="x letter">X</span>
      <span class="letter">a</span>
      <span class="letter">u</span>
      <span class="letter">c</span>
      <span class="letter">t</span>
      <span class="letter">i</span>
      <span class="letter">o</span>
      <span class="letter">n</span>
      <span class="letter">X</span>
    </div>
    <div id="progressBarContainer">
      <div id="progressBar"></div>
    </div>

    <img id="loadingGif" src="LoadingAnim.gif" alt="Loading..." />
    <iframe id="gameFrame" src="" allowfullscreen></iframe>
  </div>
  <script>
    window.addEventListener("callRedirect", function () {
      redirectToSavedUrl();
    });

    function redirectToSavedUrl() {
      const baseUrl = localStorage.getItem("savedBaseUrlParams");
      if (baseUrl) {
        window.location.href = baseUrl;
      }
    }

    const StaticProperties = {
      hostname: "",
      apiBaseURL: "https://api.auctionx.dev/",
      isProgress: false,
      isGameloaded: false
    };

    (function detectHostname() {
      const parsedUrl = new URL(window.location.href);
      StaticProperties.hostname = parsedUrl.host;
      StaticProperties.hostname = "dinesh.auctionx.dev"; // For testing
    })();
    function animateProgressBar(toPercent, duration = 400) {
      progressBar.style.transition = `width ${duration}ms cubic-bezier(.4,0,.2,1)`;
      progressBar.style.width = `${toPercent}%`;
    }

    function showProgressBar() {
      progressBarContainer.style.display = "block";
      animateProgressBar(10, 300);
    }

    function hideProgressBar() {
      progressBarContainer.style.display = "none";
      progressBar.style.width = "0%";
    }
    // Load logo dynamically
    (async function fetchAndSetLogo() {
      const progressBarContainer = document.getElementById("progressBarContainer");
      const progressBar = document.getElementById("progressBar");
      try {
        showProgressBar();
        animateProgressBar(30, 600);
        const url = `${StaticProperties.apiBaseURL}v1/auction-house/auction-house-id?subdomain=${StaticProperties.hostname}`;
        const response = await fetch(url);
        animateProgressBar(67, 600);
        const result = await response.json();
        animateProgressBar(85, 400);
        if (result.success && result.data?.currentAuctionHouse?.medias?.local_path) {
          const imagePath = result.data.currentAuctionHouse.medias.local_path;
          const imageUrl = StaticProperties.apiBaseURL + imagePath;
          const logo = document.getElementById("logo");
          logo.onload = () => {
            logo.style.display = "block";
            animateProgressBar(95, 500);
            // setTimeout(hideProgressBar, 500);
            // const event = new Event("HideSplashScreen");
            // window.parent.dispatchEvent(event);
            // hideAllElements();

          };
          logo.src = await imageUrl;
        } else {
          hideProgressBar();
        }
      } catch (error) {
        hideProgressBar();
        console.error("Error loading logo:", error);
      }
    })();
    function waitforme(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }


    // Orientation warning
    function checkOrientation() {
      const isPortrait = window.matchMedia("(orientation: portrait)").matches;
      document.getElementById("rotate-warning").style.display = isPortrait
        ? "none"
        : "block";
    }
    window.addEventListener("orientationchange", checkOrientation);
    window.addEventListener("resize", checkOrientation);
    checkOrientation();

    const gameFrame = document.getElementById("gameFrame");

    function isMobile() {
      return /Mobi|Android|iPhone|iPod/i.test(navigator.userAgent);
    }

    function setDynamicAspectRatio() {
      if (isMobile()) {
        gameFrame.style.aspectRatio = "9 / 16";
      } else {
        gameFrame.style.aspectRatio = "9 / 16";
      }
    }

    // Load game
    window.addEventListener('load', () => {
      setDynamicAspectRatio();
      gameFrame.src = 'web-mobile/index.html';
      console.log("WPA");
    });

    window.addEventListener("resize", setDynamicAspectRatio);
    window.addEventListener("orientationchange", setDynamicAspectRatio);
    // Loader controls
    window.addEventListener("showLoader", () => {
      if (!StaticProperties.isGameloaded) return;
      const loader = document.getElementById("loadingGif");
      if (loader) loader.style.display = "block";
    });

    window.addEventListener("hideLoader", async () => {
      if (!StaticProperties.isProgress) {
        await waitforme(500);
        // progressBarContainer.style.display = "none";
        // progressBar.style.width = "0%";
        animateProgressBar(100, 500);
        setTimeout(() => {
          hideProgressBar();
        }, 500);
        setTimeout(hideAllElements, 550);
        StaticProperties.isGameloaded = true;
      }
      const loader = document.getElementById("loadingGif");
      if (loader) loader.style.display = "none";
    });
    // PWA Service Worker
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker
          .register("service-worker.js")
          .then(() => console.log("Service Worker Registered"))
          .catch((err) => console.error("Service Worker Error:", err));
      });
    }
    // hideAfterProgressBar
    // window.addEventListener("hideAfterProgressBar", () => {
    //   StaticProperties.isProgress = true;
    // });

    // Hide splash screen
    function hideAllElements() {
      // if (!StaticProperties.isProgress) return
      if (window.parent.document.getElementById("gameFrame"))
        window.parent.document.getElementById("gameFrame").style.opacity = "1";

      // Remove the splash screen after it's faded out
      setTimeout(function () {
        if (window.parent.document.getElementById("splashScreen"))
          window.parent.document.getElementById("splashScreen").remove();
        if (window.parent.document.getElementById("logo"))
          window.parent.document.getElementById("logo").remove();
        if (window.parent.document.getElementById("PoweredByText"))
          window.parent.document.getElementById("PoweredByText").remove();
        if (window.parent.document.getElementById("LogoText"))
          window.parent.document.getElementById("LogoText").remove();
        // if (window.parent.document.getElementById("video"))
        //   window.parent.document.getElementById("video").remove();
        if (!StaticProperties.isGameloaded) {
          const loader = document.getElementById("loadingGif");
          if (loader) loader.style.display = "block";
        }
      }, 200);
    }
  </script>
</body>

</html>